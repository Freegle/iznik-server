<?php
require_once dirname(__FILE__) . '/../../include/config.php';
require_once(IZNIK_BASE . '/include/db.php');
require_once(IZNIK_BASE . '/include/utils.php');

$hashes = [
    '964caba3e9cbc94',
    '610b136069246e6c',
    '611135ffdfc5dddd',
    '1a25d3e3cba08890',
    '291252db53534171',
    '35ddd4cbcb461e',
    '51c48ddcc8ccc472',
    'c860e86c1c607010',
    '31d4be4f5df1cdde',
    '964e3c7e7c78d3b',
    '6121010d631d234d',
    'acf4f0e0f1f93f',
    '36cc86a2aa8adc',
    '1805312f33334bc6',
    'c98a8882c24a4',
    'dad8dadad8ec64e4',
    '231474383074109',
    '36e1e0c2cb9998',
    'd0e0e892a293e916',
    '153652938389c9c',
    '2263232335133130',
    '78603816494d5169',
    '9c03f1e1d945e082',
    '31413a6952cc682f',
    '1805212f33334bc6',
    '786038596b260e84',
    '846cc6c09220e065',
    '786058f5a1a2e367',
    'bd3e5c64b488dad0',
    '611134ffdfc5dddd',
    '30101615179696f0',
    '6202294ce97068ae',
    'bdbefcf4f4785a30',
    '14a333939797113',
    '511b494569e8a898',
    '418c4d16dbb21b8',
    'c38ba9a989425fee',
    '61e4c4a2e4bb8a59',
    '2a4a333939797113',
    '10441380b0c0503',
    'ccc8e2c8ca6ee282',
    '323088acf4f08c8e',
    '201544181c0e0e8',
    '786028f4959686e0',
    '52b3b3ba797874',
    'b2bc680b6a81905c',
    '1f1a43454f446c1d',
    '97a119114511511',
    '7860982396ce8e33',
    'f07ff3e00b114840',
    '8ead2d949e8e8e92',
    '786038977ecbce81',
    '9690146b6b6b1961',
    '4c0f171b0d4d09',
    '9adaad1b33372761',
    '96498989292b074',
    'cccae2c8ca6ee2a2',
    '6121810d631d236d',
    '86dd6a7173714101',
    '5cc8e2c8ca6ee282',
    '14bc263a1d1da59',
    '2c0c2c2c2e0406',
    'df1f1e1d1c1cd',
    '1c6cf9d5e8d858',
    '786038aac6ec553c',
    '28689c1c97979cf8',
    '1544181c0e0e8',
    '6276958c0241391a',
    '1866231303534e',
    '70000016494a0000',
    '792301703a590c09',
    '310805b265515243',
    '5b6ac3898b0f0',
    'c11a3e3236222a6',
    '786078202caa0000',
    'b2bc6c2a6a81905c',
    '1d073c3c3c3c199',
    '25d0f072b1f0b1e',
    'b2e9e23d19cff5',
    '786038d4d09ad4de',
    '6ac38484c6e5b5',
    '8a8c11d450d100',
    '120e3499cfcb29',
    '680820d82648976f',
    '1344e161f0f0f0e',
    '831403058300190',
    '786078f051572fee',
    '611114ffdfc5dddd',
    '2af1e1f150d872',
    'e83a3a707333e2',
    '17b84d0f0f2f0717',
    '6121010d631d236d',
    '22991173fe6ecef',
    '3fd54a0b17333143',
    '61218109631d236d',
    '70000045d1550000',
    '61112dffdfc5dddd',
    '7000022643420000',
    '964283a1c1d3d39',
    '160c5272b9b0b0',
    '61218189631d236d',
    '142c5252b9b0b0',
    '611369ffdfc5dddd',
    '62626325b0a38e',
    '2a313939311307',
    '2c0c5272b9b0b0',
    '35d494d8cb9cc6',
    '31420266f9aeadec',
    '152544181c0e0e8',
    '37b2163f3f331b1f',
    '112b6d4d46939c1',
    '42e97d6d4f2941e',
    '97ca699e8e8e8e8c',
    'cd6363c3070e8e',
    '611129ffdfc5dddd',
    '70001a1825180000',
    'e8f8eed7ddd65e1f',
    'f5e47564d45088a8',
    '8e4f172c2c1ecc4d',
    '30001a1825180000',
    '180401c3c124e220',
    '70000009162a0000',
    '4b4d716969acc286',
    '1fb92a0b2f03333b',
    '7860387c4e41818e',
    '16cc07c3e2cf9f',
    '154983634ec458d0',
    '25ac4e4c4ce8e92',
    '26ae361e2e2e2e8',
    '600b2ca3a2c38bc3',
    '61e4d4a2e4bb8a59',
    '61110cffdfc5dddd',
    '16bb45582c3834',
    '6a1512171e1d9f',
    'aae8f8e8e060e3a3',
    '30001a1835180000',
    '61112bffdfc5dddd',
    '390921703e1b1899',
    '29caafcfc6c4cc',
    '84c2c2c2c716171',
    '323760e864ec70f8',
    '20ce3c66676310b',
    '6000001956020000',
    'a8ecb8e8e870a4d6',
    '611125ffdfc5dddd',
    '7714a0f1f3f071f',
    '611139ffdfc5dddd',
    '61112affdfc5dddd',
    '786038b0dccce0e0',
    '321151a8f8f0c99a',
    '52ab0b2b2d0f161',
    '4a9ab0b096b0b414',
    '365ce1a3e2cb99',
    '116dfaf0fef4ded6',
    '9607e58e9e8e9e8e',
    '4268e74ad4d8cd92',
    '2164d4c6d0e5571',
    '42595f3e263e3cd',
    '6000001950010000',
    '1eba541f3733233b',
    '86e4358e8e8c9c98',
    '10599cb1aabaccf1',
    '1838e74ad4d8cd92',
    '255a6f5e77af2c6',
    '1eb14f0717333327',
    '1eb4570f0f1b3713',
    '409ce1c1c9eaeca',
    '1041d0f87a72747',
    'c98e787199413c',
    '8a8c159450d100',
    '786038f3f4fa6c64',
    '55ac888994c1a62',
    '6c4ae844101818',
    '42e63434dcd9181',
    '786098d89394b8d6',
    '7000053b0b2a0000',
    '3000422643420000',
    '454b66145454547',
    'f7fa9cbabc969886',
    '49421cb838bc9cd8',
    '611106ffdfc5dddd',
    '22ac8c8d1c9d0c0',
    '164e3c7e7c78d3b',
    '78607879719c84b3',
    '209d68e8eaa8cf4',
    '601905ffcfcfdfff',
    '786098d2b5b829f5',
    '602d0affcfcfdfff',
    '258c57d44cd58d',
    '42a713396372531',
    'd098782859bbb7b',
    '61112effdfc5dddd',
    'd0f0e8d6adb5dd1f',
    '114deacccccc5a7',
    '29c38484c6e5b5',
    'c19a3e3236222a6',
    '22a4848c8985870',
    'da8ac6cd9adccdb7',
    '74260b6365317169',
    'b846000103030015',
    '1fdd4b0f1f2b3333',
    '502486eea7a7e4fc',
    '600000194e0b0000',
    '449c46460323232',
    '35d494d8cbdcc6',
    '621a018f46070400',
    '1811187138227463',
    '700000490a1c0000',
    'dbacadcd6e5edddb',
    '104c7cb4c6be3b3',
    '18511e6e64e2c5dd',
    '6d18deb4f8c9d2e2',
    '814336363a62aaa',
    'c1d9d1c9',
    '6937012cb79a0fdb',
    '854c10961090b23',
    '40c9cd8d4d1c1c1',
    '786038c3e0f8e2f2',
    'a03014b969c88',
    '6121910d631d236d',
    '1fba541f3733233b',
    '61002d1b86ccc5cd',
    '84cd051d8b26272',
    '216333133532323',
    'bac8ced0555575',
    '60744e6aa283aba7',
    '263a9c9cbcb0e6c6',
    '7860b87a69e9b9bf',
    '20c544181c0e0e8',
    '610b136061246e6c',
    '61e4d4a2e4bb8a5d',
    'a80040d2ca820008',
    '27251915808e0f13',
    '5173f3b3a3b2d7cf',
    '70f777769495d49',
    '7871716938b09285',
    '97939f8e9edfd71f',
    'ccc31f536127275f',
    'bade5a96147eebd7',
    '823634e45d1cc80',
    '65da64f8acfa2e0e',
    'b16869ec2203430',
    '7cd60b09a9c96068',
    'e0e0fcfcfcdedf5',
    'f2f2d0b292d0b0f'
];

foreach ($hashes as $hash) {
    $images = $dbhr->preQuery("SELECT id FROM chat_images WHERE hash LIKE ?;", [
        trim($hash)
    ]);
    error_log("Found " . count($images) . " images with hash $hash");

    foreach ($images as $image) {
        $dbhm->preExec("UPDATE chat_messages SET imageid = NULL WHERE imageid = ?;", [
            $image['id']
        ]);

        $dbhm->preExec("DELETE FROM chat_images WHERE id = ?;", [
            $image['id']
        ]);
    }
}