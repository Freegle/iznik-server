<?php
namespace Freegle\Iznik;

require_once dirname(__FILE__) . '/../../include/config.php';
require_once(IZNIK_BASE . '/include/db.php');

require_once(IZNIK_BASE . '/include/misc/Location.php');
global $dbhr, $dbhm;

#$locs = $dbhr->query("SELECT * FROM `locations_spatial` WHERE ST_Within(locations_spatial.geometry, ST_GeomFromText('POLYGON((-0.12291000000004715 51.688947,-0.13561200000003737 51.688095,-0.14591199999995297 51.685328,-0.15449499999999716 51.685328,-0.16204800000002706 51.687457,-0.16273499999999785 51.681497,-0.17097499999999854 51.672981,-0.17406500000004144 51.67362,-0.18093099999998685 51.669148,-0.18522299999995084 51.663505,-0.18127400000003036 51.662121,-0.16616799999997056 51.658501,-0.16239199999995435 51.660843,-0.16239199999995435 51.657862,-0.15449499999999716 51.655732,-0.15312199999993936 51.651046,-0.14934500000003936 51.649768,-0.15312199999993936 51.647637,-0.14865899999995236 51.643164,-0.14316600000006474 51.640607,-0.13835900000003676 51.637198,-0.13217899999995097 51.632723,-0.12840299999993476 51.63251,-0.13458300000002055 51.62164,-0.14385200000003806 51.615245,-0.14007600000002185 51.610555,-0.12874599999997827 51.609063,-0.12531300000000556 51.610768,-0.12222299999996267 51.608849,-0.09681699999998727 51.609276,-0.05596200000002227 51.609702,-0.05321500000002288 51.608423,-0.0418849999999793 51.605864,-0.03398900000001959 51.609276,-0.0353619999999637 51.613327,-0.025749000000018896 51.621214,-0.01407599999993181 51.638902,-0.012702999999987696 51.645933,-0.012359999999944193 51.653176,-0.009955999999988308 51.66063,-0.012359999999944193 51.664251,-0.010986000000002605 51.679581,-0.028151999999977306 51.682135,-0.05973800000003848 51.682987,-0.06763499999999567 51.684477,-0.08136700000000019 51.689372,-0.09441400000002886 51.689372,-0.10814700000003086 51.6915,-0.11707300000000487 51.688095,-0.12291000000004715 51.688947))', 3857));");
$locs = $dbhr->query("SELECT * FROM `locations` WHERE areaid = 9683163");
$count = 0;

foreach ($locs as $loc) {
    $l = new Location($dbhr, $dbhm);
    $l->setParents($loc['id']);
    $count++;
    error_log("$count ");
}


